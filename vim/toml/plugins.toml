## hook の名前         実行されるタイミング                            lazy OFF   lazy ON
## hook_add            プラグインが dein.vim によって追加されたとき    OK         OK
## hook_source         プラグインが読み込まれる直前                    NG         OK
## hook_post_source    プラグインが読み込まれた直後                    NG         OK
## hook_post_update    プラグインが更新された直後                      OK         OK
## hook_done_update    プラグイン全ての更新が終わった直後              OK         OK

[[plugins]]
repo = 'Shougo/dein.vim'

[[plugins]]
repo = 'wsdjeg/dein-ui.vim'

[[plugins]]
repo = 'nvim-treesitter/nvim-treesitter'
hook_post_source= '''
lua require('treesitter_config.init')
'''
hook_post_update = 'TSUpdate'

[[plugins]]
repo = 'nvim-tree/nvim-web-devicons'
hook_post_source = '''
lua require('nvim-web-devicons_config.init')
'''

[[plugins]]
repo = 'refractalize/oil-git-status.nvim'
depends = ['stevearc/oil.nvim']

[[plugins]]
repo = 'stevearc/oil.nvim'
depends = ['refractalize/oil-git-status.nvim']
on_cmd = ['Oil']
hook_post_source = '''
lua require('oil_config.init')
'''

[[plugins]]
repo = 'nvim-lua/plenary.nvim'

[[plugins]]
repo = 'nvim-telescope/telescope-ui-select.nvim'
depends = ['nvim-telescope/telescope.nvim']
on_event = 'VimEnter'
hook_post_source = '''
lua << EOF
  local ok, telescope = pcall(require, 'telescope')
  if ok then
    pcall(telescope.load_extension, 'ui-select')
    local ext = telescope.extensions and telescope.extensions['ui-select']
    if ext and type(ext.select) == 'function' then
      vim.ui.select = ext.select
    end
  end
EOF
'''

[[plugins]]
repo  = 'nvim-telescope/telescope-fzf-native.nvim'
depends = ['nvim-telescope/telescope.nvim']
on_event = 'VimEnter'
hook_post_update = 'make'
hook_post_source = '''
lua << EOF
  local ok, telescope = pcall(require, 'telescope')
  if ok then
    pcall(telescope.load_extension, 'fzf')
  end
EOF
'''

[[plugins]]
repo = 'hrsh7th/nvim-cmp'
on_event = 'InsertEnter'
hook_add = '''
lua <<EOF
  local cmp = require('cmp')
  cmp.setup({
    mapping = {
      ['<C-p>'] = cmp.mapping.select_prev_item(),
      ['<C-n>'] = cmp.mapping.select_next_item(),
      ['<C-d>'] = cmp.mapping.scroll_docs(-4),
      ['<C-f>'] = cmp.mapping.scroll_docs(4),
      ['<C-Space>'] = cmp.mapping.complete(),
      ['<C-e>'] = cmp.mapping.close(),
      ['<CR>'] = cmp.mapping.confirm {
        behavior = cmp.ConfirmBehavior.Replace,
        select = true,
      },
    },
    sources = {
      { name = 'nvim_lsp' },
      { name = 'buffer' },
      { name = 'path' },
    },
    window = {
      documentation = {
        winhighlight = 'Normal:CmpDocumentation',
      },
    },
    experimental = {
      ghost_text = true
    }
  })
EOF
'''

[[plugins]]
repo = 'hrsh7th/cmp-buffer'

[[plugins]]
repo = 'hrsh7th/cmp-path'

[[plugins]]
repo = 'nvim-telescope/telescope.nvim'
depends = ['nvim-lua/plenary.nvim']
on_event = 'VimEnter'
hook_add= '''
lua require('telescope_config.keymap')
lua require('telescope_config.init')
'''

[[plugins]]
repo = 'github/copilot.vim'

[[plugins]]
repo = 'CopilotC-Nvim/CopilotChat.nvim'
depends = ['github/copilot.vim', 'nvim-tree/nvim-web-devicons', 'nvim-lua/plenary.nvim', 'nvim-telescope/telescope.nvim']
# CopilotChat の UI 選択（vim.ui.select）を telescope-ui-select に任せたいので、
# telescope がロード済みになってからコマンド起動で読み込む
on_cmd = ['CopilotChat', 'CopilotChatOpen', 'CopilotChatPrompts', 'CopilotChatToggle', 'CopilotChatModels']
branch = 'main'
hook_add= '''
  nnoremap <silent> ,ccc <Cmd>CopilotChatOpen<CR>
  nnoremap <silent> ,ccp <Cmd>CopilotChatPrompts<CR>
lua << EOF
  -- hook_source/hook_post_source は構成によって発火しないことがあるので、
  -- 設定側で pcall+リトライする前提で常に読み込みを試す
  pcall(require, 'copilot_chat_config.init')
EOF
'''
# lua << EOF
#   require('copilot_chat_config.init')
#   vim.api.nvim_set_hl(0, 'CopilotChatHeader',           { fg = '#ff0088', bg = 'none', bold = true })
#   vim.api.nvim_set_hl(0, 'CopilotChatHelp',             { fg = '#6666aa', bg = 'none', bold = false })
#   vim.api.nvim_set_hl(0, 'CopilotChatSeparator',        { fg = '#ffffff', bg = 'none', bold = false })
#   vim.api.nvim_set_hl(0, 'CopilotChatStatus',           { fg = '#ff9900', bg = 'none', bold = false })
#   vim.api.nvim_set_hl(0, 'CopilotChatStreamingCursor',  { fg = '#ff0099', bg = 'none', bold = false })
#   vim.api.nvim_set_hl(0, 'CopilotChatStreaming',        { fg = '#eeeeee', bg = 'none', bold = false })
# EOF
#
#   "lua require('other.copilot_chat_buffer_tag')


[[plugins]]
repo = 'thinca/vim-quickrun'
hook_add = '''
  nnoremap <Leader>r :QuickRun<CR>
  vmap <Leader>r :<C-U>QuickRun<CR>
'''

[[plugins]]
repo = 'tpope/vim-surround'

[[plugins]]
repo = 'vim-scripts/YankRing.vim'
hook_add = '''
  nmap ,y [yankring]
  nnoremap <silent> [yankring] <Cmd>YRShow<CR>
'''

[[plugins]]
repo = 'vim-scripts/Align'

#[[plugins]]
#repo = 'Valloric/MatchTagAlways'
#on_ft = ['html', 'vue', 'typescript', 'javascript', 'astro']
#hook_add = '''
#  "let g:mta_use_matchparen_group = 1
#
#  let g:mta_filetypes = {
#      \ 'html' : 1,
#      \ 'xhtml' : 1,
#      \ 'xml' : 1,
#      \ 'javascript' : 1,
#      \ 'jsx' : 1,
#      \ 'vue' : 1,
#      \ 'typescript' : 1,
#      \ 'astro' : 1,
#      \}
#'''

[[plugins]]
repo = 'tpope/vim-fugitive'

[[plugins]]
repo = 'stevearc/conform.nvim'
hook_add = '''
lua << EOF
local conform = require("conform")
conform.setup({
  formatters_by_ft = {
    typescript = { "prettier", lsp_format = "fallback" },
    javascript = { "prettier", lsp_format = "fallback" },
    astro = { "prettier", lsp_format = "fallback" },
    markdown = { "prettier", lsp_format = "fallback" },
    yaml = { "prettier", lsp_format = "fallback" },
    html = { "prettier", "markuplint", lsp_format = "fallback" },
    css = { "prettier", "stylelint", lsp_format = "fallback" },
    scss = { "prettier", "stylelint", lsp_format = "fallback" },
  },
  format_on_save = {
    timeout_ms = 2000,
    lsp_fallback = true,
    quiet = false,
  },
})
EOF
'''

[[plugins]]
repo = 'andymass/vim-matchup'
on_event = 'BufRead'
hook_add = '''
  let g:matchup_matchparen_offscreen = {'method': 'popup'}
'''

[[plugins]]
repo = 'ggandor/leap.nvim'
hook_add = '''
nmap ,l [leap]
nnoremap <silent> [leap]lf <Plug>(leap-forward)
nnoremap <silent> [leap]lb <Plug>(leap-backward)
nnoremap <silent> [leap]lw <Plug>(leap-from-window)
'''
